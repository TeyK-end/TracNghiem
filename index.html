<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Online Quiz App</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
        font-size: 16px; /* Base font size for mobile */
      }
      .container {
        display: flex;
        flex-direction: column; /* Stack elements vertically on mobile */
        background: white;
        padding: 1rem;
        border-radius: 10px;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 100vw; /* Full width on mobile */
        box-sizing: border-box;
      }
      #timer {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
        text-align: center;
        transition: color 0.3s;
      }
      .timer-warning {
        color: #ff3b3b;
        animation: pulse 1s infinite;
      }

      #score {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
        font-weight: bold;
        text-align: center;
      }
      .progress-bar {
        width: 100%;
        height: 8px;
        background-color: #e0e0e0;
        border-radius: 5px;
        margin-bottom: 0.5rem;
      }
      .progress-fill {
        height: 100%;
        background-color: #0099ff; /* xanh biển thay xanh lá */
        border-radius: 5px;
        transition: width 0.3s ease-in-out;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(
          auto-fit,
          minmax(40px, 1fr)
        ); /* Responsive grid */
        gap: 0.3rem;
        margin-bottom: 1rem;
        max-height: 100px; /* Reduced height for mobile */
        overflow-y: auto;
        padding: 0.5rem;
      }
      .grid div {
        width: 100%;
        height: 40px;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background-color 0.3s, transform 0.2s;
      }
      .grid div:hover {
        background-color: #f5f5f5;
        transform: scale(1.05);
      }
      .grid .answered {
        background-color: #d4edda;
      }
      .grid .current {
        background-color: #0099ff; /* xanh biển */
        color: white;
      }
      .question-panel {
        width: 100%;
        text-align: left;
        padding: 0.5rem;
      }
      .options {
        margin-top: 1rem;
        display: flex;
        flex-direction: column; /* Stack buttons vertically */
        gap: 0.5rem;
      }
     .options button {
            padding: 0.8rem;
            font-size: 1rem;
            cursor: pointer;
            background-color: #00cfff; /* xanh ngọc */
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
            width: 100%;
        }
      .options button:hover {
            background-color: #0099ff; /* xanh biển đậm hơn khi hover */
            transform: scale(1.02);
        }
      .options button.selected {
            background-color: #9b00ff; /* tím highlight */
        }
        .options button.correct {
            background-color: #d633ff; /* tím hồng nổi bật */
        }
        .options button.incorrect {
            background-color: #ff3b3b; /* đỏ sai */
        }
      #result {
        margin-top: 0.5rem;
        font-weight: bold;
        font-size: 0.9rem;
        text-align: center;
      }
     #submitBtn {
            margin-top: 1rem;
            padding: 0.8rem;
            font-size: 1rem;
            width: 100%;
            background-color: #ff3b3b; /* đỏ submit */
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
       #submitBtn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
      #startScreen {
        text-align: center;
        padding: 1rem;
        width: 100%;
      }
      #startScreen select,
      #startScreen button {
        padding: 0.8rem;
        margin: 0.5rem 0;
        font-size: 1rem;
        border-radius: 5px;
        width: 100%;
        box-sizing: border-box;
      }
      #startScreen button {
            background-color: #0099ff; /* xanh biển start */
            color: white;
            border: none;
            cursor: pointer;
        }
       #startScreen button:hover {
            background-color: #006bb3; /* xanh biển đậm khi hover */
        }
      #startScreen button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }
      .hidden {
        display: none;
      }
      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
        100% {
          opacity: 1;
        }
      }
      /* Media query for smaller screens */
      @media (max-width: 600px) {
        body {
          font-size: 14px;
        }
        .container {
          padding: 0.5rem;
        }
        .grid {
          grid-template-columns: repeat(auto-fit, minmax(35px, 1fr));
          max-height: 80px;
        }
        .grid div {
          height: 35px;
          font-size: 0.8rem;
        }
        .options button,
        #submitBtn {
          padding: 0.6rem;
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="startScreen">
      <h2>Select Quiz Part and Duration</h2>
      <select id="partSelect">
        <option value="part1">Part 1</option>
        <option value="part2">Part 2</option>
        <option value="part3">Part 3</option>
        <option value="part4">Part 4</option>
        <option value="part5">Part 5</option>
        <option value="part6">Part 6</option>



      </select>
      <br />
      <select id="timeSelect">
        <option value="5">5 minutes</option>
        <option value="10">10 minutes</option>
        <option value="15">15 minutes</option>
        <option value="20">20 minutes</option>
        <option value="30" selected>30 minutes</option>
      </select>
      <br />
      <button id="startBtn">Start Quiz</button>
    </div>
    <div class="container hidden" id="quizContainer">
      <div>
        <div id="timer">Time: 30:00</div>
        <div id="score">Score: Not submitted</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="grid" id="grid"></div>
      </div>
      <div class="question-panel">
        <div id="question"></div>
        <div class="options" id="options"></div>
        <div id="result"></div>
        <button id="submitBtn" onclick="submitQuiz()">Submit</button>
      </div>
    </div>
    <audio
      id="selectSound"
      src="https://www.soundjay.com/buttons/button-3.mp3"
    ></audio>
    <audio
      id="submitSound"
      src="https://www.soundjay.com/buttons/button-4.mp3"
    ></audio>

    <script>
      const timerDisplay = document.getElementById("timer");
      const scoreDisplay = document.getElementById("score");
      const grid = document.getElementById("grid");
      const questionDisplay = document.getElementById("question");
      const optionsDisplay = document.getElementById("options");
      const resultDisplay = document.getElementById("result");
      const submitBtn = document.getElementById("submitBtn");
      const progressFill = document.getElementById("progressFill");
      const selectSound = document.getElementById("selectSound");
      const submitSound = document.getElementById("submitSound");
      const startScreen = document.getElementById("startScreen");
      const timeSelect = document.getElementById("timeSelect");
      const partSelect = document.getElementById("partSelect");
      const startBtn = document.getElementById("startBtn");
      const quizContainer = document.getElementById("quizContainer");

      let time;
      let questions = [];
      let currentQuestionIndex = -1;
      let selectedAnswers =
        JSON.parse(localStorage.getItem("quizAnswers")) || {};
      let isSubmitted =
        JSON.parse(localStorage.getItem("quizSubmitted")) || false;
      let countdown;
      let selectedPart = "part1"; // Default part

      // Load questions from JSON based on selected part
      function loadQuestions() {
        fetch("questions.json")
          .then((response) => response.json())
          .then((data) => {
            questions = data[selectedPart] || [];
            grid.innerHTML = ""; // Clear grid
            grid.style.display = "grid";
            grid.style.gridTemplateColumns =
              "repeat(auto-fit, minmax(40px, 1fr))";
            grid.style.maxHeight = "100px";
            grid.style.overflowY = "auto";
            for (let i = 0; i < questions.length; i++) {
              const div = document.createElement("div");
              div.textContent = i + 1;
              div.onclick = () => showQuestion(i);
              if (selectedAnswers[`${selectedPart}_${i}`]) {
                div.classList.add("answered");
              }
              grid.appendChild(div);
            }
            updateProgress();
            if (questions.length > 0) {
              showQuestion(0); // Show first question
            }
          })
          .catch((error) => console.error("Error loading questions:", error));
      }

      // Start quiz
      startBtn.onclick = () => {
        selectedPart = partSelect.value;
        time = parseInt(timeSelect.value) * 60;
        startScreen.classList.add("hidden");
        quizContainer.classList.remove("hidden");
        loadQuestions();
        startTimer();
        submitBtn.disabled = false;
      };

      // Timer
      function startTimer() {
        countdown = setInterval(() => {
          let minutes = Math.floor(time / 60);
          let seconds = time % 60;
          timerDisplay.textContent = `Time: ${minutes}:${
            seconds < 10 ? "0" : ""
          }${seconds}`;
          if (time <= 300) {
            timerDisplay.classList.add("timer-warning");
          }
          if (time <= 0) {
            clearInterval(countdown);
            resultDisplay.textContent = "Time is up!";
            submitBtn.disabled = false;
            submitQuiz();
          }
          time--;
        }, 1000);
      }

      function showQuestion(index) {
        if (index >= 0 && index < questions.length) {
          currentQuestionIndex = index;
          const q = questions[index];
          questionDisplay.textContent = q.question;
          optionsDisplay.innerHTML = "";
          q.options.forEach((option) => {
            const button = document.createElement("button");
            button.textContent = option;
            button.onclick = isSubmitted
              ? null
              : () => selectAnswer(index, option);
            if (selectedAnswers[`${selectedPart}_${index}`] === option) {
              button.classList.add("selected");
              if (isSubmitted) {
                if (option === q.answer) {
                  button.classList.add("correct");
                } else {
                  button.classList.add("incorrect");
                }
              }
            }
            if (isSubmitted && option === q.answer) {
              button.classList.add("correct");
            }
            optionsDisplay.appendChild(button);
          });
          if (isSubmitted) {
            const isCorrect =
              selectedAnswers[`${selectedPart}_${index}`] === q.answer;
            if (isCorrect) {
              resultDisplay.textContent = `Correct!`;
              resultDisplay.style.color = "Blue";
            } else {
              resultDisplay.textContent = `Incorrect. Your answer: ${
                selectedAnswers[`${selectedPart}_${index}`] || "None"
              }. Correct answer: ${q.answer}`;
              resultDisplay.style.color = "red";
            }
          } else {
            resultDisplay.textContent = "";
          }
          document
            .querySelectorAll(".grid div")
            .forEach((div) => div.classList.remove("current"));
          grid.children[index].classList.add("current");
        }
      }

      function selectAnswer(index, answer) {
        selectedAnswers[`${selectedPart}_${index}`] = answer;
        localStorage.setItem("quizAnswers", JSON.stringify(selectedAnswers));
        selectSound.play();
        grid.children[index].classList.add("answered");
        document.querySelectorAll(".options button").forEach((btn) => {
          btn.classList.toggle("selected", btn.textContent === answer);
        });
        updateProgress();
      }

      function updateProgress() {
        const answeredCount = Object.keys(selectedAnswers).filter((key) =>
          key.startsWith(selectedPart)
        ).length;
        const progressPercent = (answeredCount / questions.length) * 100;
        progressFill.style.width = `${progressPercent}%`;
      }

      function submitQuiz() {
        isSubmitted = true;
        localStorage.setItem("quizSubmitted", JSON.stringify(isSubmitted));
        let score = 0;
        let resultText = "Quiz submitted! Results:\n";
        for (let i = 0; i < questions.length; i++) {
          const isCorrect =
            selectedAnswers[`${selectedPart}_${i}`] === questions[i].answer;
          if (selectedAnswers[`${selectedPart}_${i}`]) {
            if (isCorrect) {
              score++;
              resultText += `Question ${i + 1}: Correct\n`;
            } else {
              resultText += `Question ${i + 1}: Incorrect. Your answer: ${
                selectedAnswers[`${selectedPart}_${i}`]
              }. Correct answer: ${questions[i].answer}\n`;
            }
          } else {
            resultText += `Question ${i + 1}: Not answered. Correct answer: ${
              questions[i].answer
            }\n`;
          }
        }
        scoreDisplay.textContent = `Score: ${score}/${questions.length}`;
        resultDisplay.textContent = resultText;
        resultDisplay.style.color = "blue";
        submitBtn.disabled = true;
        submitSound.play();
        localStorage.removeItem("quizAnswers");
        localStorage.removeItem("quizSubmitted");
        clearInterval(countdown);
        if (currentQuestionIndex >= 0) {
          showQuestion(currentQuestionIndex);
        }
      }
    </script>
  </body>
</html>
